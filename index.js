
      const QUIZZES = {
        Quran: [
          {
            q: 'Which Surah begins with "Alhamdulillah"?',
            opts: ["Al-Fatiha", "Al-Baqarah", "Al-Anfal"],
            correct: 1,
          },
          {
            q: "How many Juz are in the Quran?",
            opts: ["30", "20", "10"],
            correct: 0,
          },
          {
            q: "In which surah is Ayat al-Kursi found?",
            opts: ["Al-Baqarah", "Al-Ikhlas", "Al-Falaq"],
            correct: 0,
          },
          {
            q: 'Which Surah is called "The Cow"?',
            opts: ["Al-Imran", "Al-Baqarah", "An-Nisa"],
            correct: 1,
          },
          {
            q: "Which Prophet is associated with the story of the whale?",
            opts: ["Yunus", "Musa", "Ibrahim"],
            correct: 0,
          },
          {
            q: "Which surah is recited in every rak'ah of Fajr?",
            opts: ["Al-Fatiha", "Al-Ikhlas", "Al-Kafirun"],
            correct: 0,
          },
          {
            q: "The Quran was revealed over how many years?",
            opts: ["23 years", "13 years", "40 years"],
            correct: 0,
          },
          {
            q: "Which Surah is the longest?",
            opts: ["An-Nisa", "Al-Baqarah", "Al-Imran"],
            correct: 1,
          },
          {
            q: 'How many times is the word "Allah" mentioned roughly in Quran?',
            opts: ["~2000", "~1000", "~600"],
            correct: 0,
          },
          {
            q: "Which surah is named after a woman?",
            opts: ["Maryam", "Fatir", "Nisa"],
            correct: 0,
          },
        ],
        Hadith: [
          {
            q: "Who compiled Sahih al-Bukhari?",
            opts: ["Imam Bukhari", "Imam Muslim", "Imam Tirmidhi"],
            correct: 0,
          },
          {
            q: "Hadith describes reports of the sayings of which person?",
            opts: [
              "Prophet Muhammad (PBUH)",
              "Prophet Musa",
              "Imam Abu Hanifa",
            ],
            correct: 0,
          },
          {
            q: "The science of Hadith studies is called?",
            opts: ["Ilm al-Hadith", "Ilm al-Fiqh", "Ilm al-Kalam"],
            correct: 0,
          },
          {
            q: "Which companion narrated many hadiths and is famous for it?",
            opts: ["Abu Hurairah", "Ibn Abbas", "Abu Bakr"],
            correct: 0,
          },
          {
            q: "Sahih Muslim was compiled by?",
            opts: ["Imam Muslim", "Imam Malik", "Imam Ahmad"],
            correct: 0,
          },
          {
            q: "A weak hadith is called?",
            opts: ["Da'if", "Sahih", "Hasan"],
            correct: 0,
          },
          {
            q: "“Actions are judged by intentions” is a hadith beginning of which collection?",
            opts: ["Sahih al-Bukhari", "Sunan Abu Dawood", "Jami at-Tirmidhi"],
            correct: 0,
          },
          {
            q: "The science verifying narrators is called?",
            opts: ["Ilm al-Rijal", "Ilm al-Tafsir", "Ilm al-Fiqh"],
            correct: 0,
          },
          {
            q: "A hadith with continuous isnad is known as?",
            opts: ["Muttaṣil", "Munqatiʻ", "Mursal"],
            correct: 0,
          },
          {
            q: "Which term means a hadith that is sound and strong?",
            opts: ["Sahih", "Da'if", "Munqar"],
            correct: 0,
          },
        ],
        History: [
          {
            q: "Where was the Prophet Muhammad (PBUH) born?",
            opts: ["Mecca", "Medina", "Taif"],
            correct: 0,
          },
          {
            q: "The Hijra (migration) happened in which year (Gregorian)?",
            opts: ["622", "610", "632"],
            correct: 0,
          },
          {
            q: "Which battle was the first major battle of Muslims against Meccans?",
            opts: ["Badr", "Uhud", "Khandaq"],
            correct: 0,
          },
          {
            q: "Who was the first Caliph after the Prophet (PBUH)?",
            opts: ["Abu Bakr", "Umar ibn al-Khattab", "Uthman ibn Affan"],
            correct: 0,
          },
          {
            q: "Which caliph completed the compilation of Quran in one book",
            opts: ["Uthman", "Abu Bakr", "Umar"],
            correct: 0,
          },
          {
            q: "The city of Medina was earlier known as?",
            opts: ["Yathrib", "Jeddah", "Taif"],
            correct: 0,
          },
          {
            q: "Which mosque was the first mosque built by Prophet (PBUH)?",
            opts: ["Quba", "Al-Masjid an-Nabawi", "Masjid al-Haram"],
            correct: 0,
          },
          {
            q: "Which empire did many Muslim scholars belong to in Golden Age?",
            opts: ["Abbasid", "Roman", "Byzantine"],
            correct: 0,
          },
          {
            q: "Who led the Muslims in the conquest of Mecca?",
            opts: [
              "Prophet Muhammad (PBUH)",
              "Khalid ibn al-Walid",
              "Abu Bakr",
            ],
            correct: 0,
          },
          {
            q: "The Battle of Uhud took place near which city?",
            opts: ["Medina", "Mecca", "Taif"],
            correct: 0,
          },
        ],
        Prophets: [
          {
            q: "Which prophet built the Kaaba with his son?",
            opts: ["Ibrahim (AS)", "Nuh (AS)", "Musa (AS)"],
            correct: 0,
          },
          {
            q: "Prophet Musa (Moses) received the commandments on which mountain?",
            opts: ["Tur", "Arafat", "Sinai"],
            correct: 2,
          },
          {
            q: "Prophet Nuh (Noah) built an ark to survive which event?",
            opts: ["Flood", "Drought", "Plague"],
            correct: 0,
          },
          {
            q: "Which prophet was known for his patience and endurance?",
            opts: ["Ayyub (AS)", "Yusuf (AS)", "Ibrahim (AS)"],
            correct: 0,
          },
          {
            q: "Yusuf (Joseph) was sold into slavery by his",
            opts: ["brothers", "friends", "enemies"],
            correct: 0,
          },
          {
            q: "Which prophet spoke to birds according to Quran?",
            opts: ["Sulaiman (AS)", "Shuayb (AS)", "Yunus (AS)"],
            correct: 0,
          },
          {
            q: "Which prophet was swallowed by a whale?",
            opts: ["Yunus (AS)", "Hud (AS)", "Saleh (AS)"],
            correct: 0,
          },
          {
            q: "Prophet Isa (Jesus) was born to which woman?",
            opts: ["Maryam", "Hawa", "Sarah"],
            correct: 0,
          },
          {
            q: "Who is the last Prophet in Islam?",
            opts: ["Muhammad (PBUH)", "Isa (AS)", "Musa (AS)"],
            correct: 0,
          },
          {
            q: "Which prophet is associated with the staff and sea splitting?",
            opts: ["Musa (AS)", "Ibrahim (AS)", "Nuh (AS)"],
            correct: 0,
          },
        ],
      };

      /* -------------------------
   Storage & helpers
   ------------------------- */
      function load(key, fallback) {
        try {
          const v = localStorage.getItem(key);
          return v ? JSON.parse(v) : fallback;
        } catch (e) {
          return fallback;
        }
      }
      function save(key, val) {
        localStorage.setItem(key, JSON.stringify(val));
      }

      let USERS = load("islamiq_users", []); // {email, password, name}
      let ATTEMPTS = load("islamiq_attempts", []); // {user, category, score, total, dateISO}

      const PER_QUESTION_SECONDS = 60; // 60 seconds per question (change here if you want)

      /* -------------------------
   App state
   ------------------------- */
      const state = {
        view: "home",
        currentUser: load("islamiq_current_user", null), // {email,name}
        category: null,
        qlist: [],
        index: 0,
        answers: [], // selected indices or null
        remaining: PER_QUESTION_SECONDS,
        timerHandle: null,
      };

      /* -------------------------
   DOM Refs
   ------------------------- */
      const el = (id) => document.getElementById(id);
      const screens = {
        home: el("home"),
        auth: el("auth"),
        categories: el("categories"),
        quiz: el("quiz"),
        results: el("results"),
      };

      const startBtn = el("startBtn");
      const btnLogin = el("btnLogin");
      const btnHome = el("btnHome");
      const userLabel = el("userLabel");

      const catGrid = el("catGrid");

      const progressLabel = el("progressLabel");
      const timerEl = el("timer");
      const qtext = el("qtext");
      const optionsEl = el("options");
      const prevBtn = el("prevBtn");
      const nextBtn = el("nextBtn");
      const submitBtn = el("submitBtn");
      const infoCat = el("infoCat");
      const infoTotal = el("infoTotal");
      const infoTime = el("infoTime");
      const infoProgress = el("infoProgress");

      const emailIn = el("emailIn");
      const passIn = el("passIn");
      const toggleAuth = el("toggleAuth");
      const authSubmit = el("authSubmit");

      const scoreText = el("scoreText");
      const scorePercent = el("scorePercent");
      const correctWrap = el("correctWrap");
      const wrongWrap = el("wrongWrap");
      const btnHomeFromResults = el("btnHomeFromResults");
      const btnRetry = el("btnRetry");
      const statWeek = el("statWeek");
      const statMonth = el("statMonth");
      const statAll = el("statAll");

      /* -------------------------
   Navigation & views
   ------------------------- */
      function show(view) {
        state.view = view;
        Object.values(screens).forEach((s) => s.classList.remove("active"));
        screens[view].classList.add("active");
      }
      function refreshUserUI() {
        state.currentUser = load("islamiq_current_user", state.currentUser);
        if (state.currentUser)
          userLabel.textContent = `Hi, ${state.currentUser.name}`;
        else userLabel.textContent = "Not signed in";
      }

      /* -------------------------
   Auth (local demo)
   ------------------------- */
    let authMode = "login"; // or signup
toggleAuth.textContent = "Switch to Sign up";

toggleAuth.onclick = () => {
  authMode = authMode === "login" ? "signup" : "login";
  toggleAuth.textContent =
    authMode === "login" ? "Switch to Sign up" : "Switch to Log in";
  authSubmit.textContent =
    authMode === "login" ? "Continue" : "Create account";
  el("auth").querySelector("h3").textContent =
    authMode === "login" ? "Sign in" : "Sign up";
};

authSubmit.onclick = () => {
  const email = emailIn.value.trim().toLowerCase();
  const pass = passIn.value.trim();

  if (!email || !pass) {
    alert("Provide email and password");
    return;
  }

  if (authMode === "signup") {
    // Check if email already exists (case-insensitive)
    if (USERS.some((u) => u.email.toLowerCase() === email)) {
      alert("User exists, please sign in");
      return;
    }
    const name = email.split("@")[0];
    USERS.push({ email, password: pass, name });
    save("islamiq_users", USERS);
    save("islamiq_current_user", { email, name });
    refreshUserUI();
    emailIn.value = "";
    passIn.value = "";
    show("categories");
  } else {
    // Login: match email (case-insensitive) and exact password
    const u = USERS.find(
      (u) => u.email.toLowerCase() === email && u.password === pass
    );
    if (!u) {
      alert("Invalid credentials");
      return;
    }
    save("islamiq_current_user", { email: u.email, name: u.name });
    refreshUserUI();
    emailIn.value = "";
    passIn.value = "";
    show("categories");
  }
};


      /* -------------------------
   Categories render
   ------------------------- */
      function renderCategories() {
        catGrid.innerHTML = "";
        for (const cat of Object.keys(QUIZZES)) {
          const d = document.createElement("div");
          d.className = "card";
          d.innerHTML = `<h3>${cat}</h3><p>${QUIZZES[cat].length} questions available</p>`;
          d.onclick = () => startQuiz(cat);
          catGrid.appendChild(d);
        }
      }

      /* -------------------------
   Start quiz for category
   ------------------------- */
      function startQuiz(cat) {
        // prepare question list (shuffle)
        const source = QUIZZES[cat].slice();
        // shuffle
        for (let i = source.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [source[i], source[j]] = [source[j], source[i]];
        }
        // use up to 12 questions or all
        const num = Math.min(12, source.length);
        const qlist = source.slice(0, num);
        state.category = cat;
        state.qlist = qlist;
        state.index = 0;
        state.answers = new Array(qlist.length).fill(null);
        state.remaining = PER_QUESTION_SECONDS;
        // UI
        infoCat.textContent = cat;
        infoTotal.textContent = qlist.length;
        infoTime.textContent = `${PER_QUESTION_SECONDS}s`;
        infoProgress.textContent = `0 answered`;
        renderQuestion();
        startTimer();
        show("quiz");
      }

      /* -------------------------
   Render question
   ------------------------- */
      function renderQuestion() {
        const i = state.index;
        const item = state.qlist[i];
        progressLabel.textContent = `Question ${i + 1} / ${state.qlist.length}`;
        qtext.textContent = item.q;
        optionsEl.innerHTML = "";
        item.opts.forEach((opt, idx) => {
          const o = document.createElement("div");
          o.className =
            "option" + (state.answers[i] === idx ? " selected" : "");
          o.innerHTML = `<div class="label">${String.fromCharCode(
            65 + idx
          )}</div><div class="opt-text">${opt}</div>`;
          o.onclick = () => {
            state.answers[i] = idx;
            // mark selection visually
            document
              .querySelectorAll(".option")
              .forEach((x) => x.classList.remove("selected"));
            o.classList.add("selected");
            updateProgress();
          };
          optionsEl.appendChild(o);
        });
        prevBtn.disabled = i === 0;
        nextBtn.disabled = i >= state.qlist.length - 1;
        timerEl.textContent = formatTime(state.remaining);
      }
      function updateProgress() {
        const answered = state.answers.filter((x) => x !== null).length;
        infoProgress.textContent = `${answered} answered`;
      }

      /* -------------------------
   Timer (per-question)
   ------------------------- */
      function formatTime(s) {
        const m = String(Math.floor(s / 60)).padStart(2, "0");
        const ss = String(s % 60).padStart(2, "0");
        return `${m}:${ss}`;
      }
      function startTimer() {
        clearInterval(state.timerHandle);
        state.remaining = PER_QUESTION_SECONDS;
        timerEl.textContent = formatTime(state.remaining);
        state.timerHandle = setInterval(() => {
          state.remaining--;
          timerEl.textContent = formatTime(state.remaining);
          if (state.remaining <= 0) {
            clearInterval(state.timerHandle);
            // auto-move to next question or finish if last
            if (state.index < state.qlist.length - 1) {
              state.index++;
              state.remaining = PER_QUESTION_SECONDS;
              renderQuestion();
              startTimer();
            } else {
              // auto-submit at end
              finishQuiz(true);
            }
          }
        }, 1000);
      }

      /* -------------------------
   Navigation buttons
   ------------------------- */
      prevBtn.onclick = () => {
        if (state.index > 0) {
          state.index--;
          state.remaining = PER_QUESTION_SECONDS;
          renderQuestion();
          startTimer();
        }
      };
      nextBtn.onclick = () => {
        if (state.index < state.qlist.length - 1) {
          state.index++;
          state.remaining = PER_QUESTION_SECONDS;
          renderQuestion();
          startTimer();
        }
      };

      /* -------------------------
   Submit & scoring
   ------------------------- */
      submitBtn.onclick = () => {
        if (!confirm("Submit quiz now?")) return;
        finishQuiz(false);
      };

      function finishQuiz(autofinish) {
        clearInterval(state.timerHandle);
        const total = state.qlist.length;
        let correct = 0;
        const correctIdx = [],
          wrongIdx = [];
        state.qlist.forEach((q, i) => {
          if (state.answers[i] === q.correct) {
            correct++;
            correctIdx.push(i + 1);
          } else wrongIdx.push(i + 1);
        });

        // store attempt
        const user = load("islamiq_current_user", null);
        const attempt = {
          user: user ? user.name : "Guest",
          category: state.category,
          score: correct,
          total,
          date: new Date().toISOString(),
        };
        ATTEMPTS.unshift(attempt);
        if (ATTEMPTS.length > 2000) ATTEMPTS = ATTEMPTS.slice(0, 2000);
        save("islamiq_attempts", ATTEMPTS);

        // render results
        scoreText.textContent = `${correct} / ${total}`;
        const pct = Math.round((correct / total) * 100);
        scorePercent.textContent =
          `${pct}% correct` + (autofinish ? " (auto-submitted)" : "");
        correctWrap.innerHTML = correctIdx.length
          ? correctIdx
              .map(
                (n) =>
                  `<div style="background:rgba(63,224,141,0.06);padding:6px 10px;border-radius:8px;color:var(--accent)">${n}</div>`
              )
              .join("")
          : '<div class="muted">None</div>';
        wrongWrap.innerHTML = wrongIdx.length
          ? wrongIdx
              .map(
                (n) =>
                  `<div style="background:rgba(255,255,255,0.02);padding:6px 10px;border-radius:8px;color:var(--muted)">${n}</div>`
              )
              .join("")
          : '<div class="muted">None</div>';

        // stats
        renderStats();
        show("results");
      }

      /* -------------------------
   Stats / leaderboard style
   ------------------------- */
      function renderStats() {
        const now = new Date();
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const monthAgo = new Date(
          now.getFullYear(),
          now.getMonth() - 1,
          now.getDate()
        );
        const cat = state.category;
        const filtered = ATTEMPTS.filter((a) => a.category === cat);
        const week = filtered.filter((a) => new Date(a.date) >= weekAgo).length;
        const month = filtered.filter(
          (a) => new Date(a.date) >= monthAgo
        ).length;
        statWeek.textContent = week;
        statMonth.textContent = month;
        statAll.textContent = filtered.length;
      }

      /* -------------------------
   Buttons: nav, login, home
   ------------------------- */
      startBtn.onclick = () => {
        // require login first
        // show auth screen
        show("auth");
      };
      btnLogin.onclick = () => show("auth");
      btnHome.onclick = () => show("home");
      btnHomeFromResults.onclick = () => show("home");
      btnRetry.onclick = () => {
        if (state.category) startQuiz(state.category);
        else show("categories");
      };

      /* -------------------------
   Init
   ------------------------- */
      function init() {
        refreshUserUI();
        renderCategories();
        show("home");
      }
      init();

      /* persist loaded USERS and ATTEMPTS to localStorage on first use */
      save("islamiq_users", USERS);
      save("islamiq_attempts", ATTEMPTS);

      /* small extras: allow clicking userLabel to sign out */
      userLabel.addEventListener("click", () => {
        if (load("islamiq_current_user", null) && confirm("Sign out?")) {
          localStorage.removeItem("islamiq_current_user");
          state.currentUser = null;
          refreshUserUI();
        }
      });

      /* convenience: go to categories after login or when auth modal submitted */
      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && state.view === "auth") {
          authSubmit.click();
        }
      });

      /* after categories page shown, render categories in DOM every time */
      function renderCategories() {
        catGrid.innerHTML = "";
        for (const k of Object.keys(QUIZZES)) {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `<h3>${k}</h3><p>${QUIZZES[k].length} questions</p>`;
          card.onclick = () => {
            startQuiz(k);
          };
          catGrid.appendChild(card);
        }
      }
      renderCategories();

      /* make sure UI reflects current user on load */
      refreshUserUI();